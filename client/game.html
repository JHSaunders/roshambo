<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
          PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<link rel="stylesheet" href="style.css"/>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"/>
	</script>
	<script>
		function show_result(result) {
			return function() {
				clear_options();
				$("#try-again").hide();
				if (result["result"]!="draw") {						
					$("#options").hide();
				} else {

					$("#try-again").show();
				}
				switch(result["result"]){				
					case "win":
						$("#result").html("You win!");
						$("#beats").html("beats");
					break;
					case "lose":
						$("#result").html("You lose!");
						$("#beats").html("loses to");
					break;
					case "draw":
						$("#result").html("Its a draw! Try again.");
						$("#beats").html("is the same as");
					break;
				}
				$("#results").show();
				your_choice= result["you"]
				opponent_choice= result["opponent"]

				$("#your-move").attr("src","static/images/"+your_choice+"-white.png");
				$("#opponent-move").attr("src","static/images/"+opponent_choice+"-white.png");
			}
		}

		function clear_options(){
			weapons = ["rock","paper","scissors"]
			for (i in weapons) {
			x = weapons[i]	
			$("#"+x+" img").attr("src","static/images/"+x+"-white.png");
			}

		}


		function select_option(weapon) {
 			clear_options();
			$("#"+weapon+" img").attr("src","static/images/"+weapon+"-black.png");
			

			result = "draw";
			
			if (weapon=="paper") {
				result = "win";
			} else if (weapon=="scissors"){
				result = "lose";
			}

			res = {"you":weapon,"opponent":"rock","result":result};
			
			window.setTimeout(show_result(res), 500);		
		}

		function check_for_opponent(){
			$("#waiting").hide();
			$("#options").show();
		}

		$(function(){
			window.setTimeout(check_for_opponent, 2000);
		})
	</script>
	<title>Ro-Sham-Bo</title>
</head>
<body>
	<div id="waiting">
		<h1>Waiting for your opponent</h1>
		<h1>Send this to your opponent: http://rsb.com/1244</h1>
	</div>

	<div id="results">
		<h1 id="result"></h1>
		<img id="your-move"/>
		<span id ="beats">beats</span>
		<img id="opponent-move"/>
		<h1 id="try-again">Try again</h1>
	</div>
	<div id="options">
		<h1>Choose your weapon</h1>
		<a id = "rock" href='javascript:select_option("rock")'><img src="static/images/rock-white.png"></a>
		<a id = "paper" href='javascript:select_option("paper")'><img src="static/images/paper-white.png"></a>
		<a id = "scissors" href='javascript:select_option("scissors")'><img src="static/images/scissors-white.png"></a>

	</div>
</body>
</html>
